module fnet_EMM

! a = 0.00000365
! b = 0.07965


intrinsic Reshape
real, dimension(8, 119) :: input = &
  Reshape((/-0.72781181,6.87576532,4.01884079,7.31639242,4.35763931,-5.07601833,-2.70681429,-1.38339221,-1.14438117,15.34989929,5.89828491,8.41578770 &
            ,10.58931637,16.90625000,10.38060284,-2.44511819,-4.15490913,-0.29380888,-1.59449029,-2.38150001,-2.16173363,1.12445390,-0.15509549,2.91404414 &
            ,-0.61132044,-2.04697442,-1.32349098,-0.99907076,-1.67899632,2.39434052,-2.06887150,0.18526430,2.54602289,-2.57727313,0.87363642,-3.96020269 &
            ,4.68502855,3.12168002,1.05454361,-3.83852911,-10.43959618,-7.46794844,-7.24327612,-5.59901142,-2.99150443,-0.35770577,-4.06471968,-16.22914505 &
            ,-0.53002548,8.47547245,0.58547640,-0.62303245,3.55801415,-2.57767820,-1.36108398,1.09193122,1.65392947,1.84911752,-0.00130384,-16.37422180 &
            ,-8.72373581,8.04720116,-4.92015409,-0.00139226,14.24433804,2.28741312,-1.46086967,-0.96113288,-0.75903708,-1.22374082,0.07812464,1.60169220 &
            ,-0.26525265,-0.84721231,-1.59984756,-5.12211132,-0.61545014,-0.61773992,-4.87049675,-1.67141378,1.63662922,-11.53621006,3.82923102,1.10429943 &
            ,-1.63929820,-1.20899403,-0.26750284,-3.08003378,-0.20468096,-0.50966215,-2.27251625,-0.81859535,-2.42674184,-4.21632528,8.29244232,5.10461807 &
            ,6.10395050,0.77496159,1.84939885,-3.88151646,-1.05496526,-1.25973141,-0.04264538,0.31543592,0.14365949,0.18924589,0.12274629,0.33112675 &
            ,0.39819846,0.65591443,-0.30376485,-1.50888896,-0.77908397,-0.76935005,1.29950666,1.17205882,-5.08876181,-1.51896226,-1.88376617,5.78283691 &
            ,1.09650207,2.17329812,3.56963348,3.85605669,1.14081907,-3.18857145,-5.66945410,-7.31385851,-14.95654488,-9.85108662,-17.12704849,-1.63426781 &
            ,2.85608792,-4.81195974,-9.43445969,-6.63239431,-0.20664671,-1.29415345,0.27507472,-0.01549175,-1.69637680,0.57386160,-1.71417332,4.58501577 &
            ,-2.39204764,-0.35983437,2.70134354,1.07252741,-0.25970411,0.60948491,-2.01842093,-3.73841238,3.86522102,-0.69220966,-4.69076157,-3.03365827 &
            ,-4.79404640,-7.83695269,1.05377853,-0.27937353,-1.11091757,1.46773446,0.32404321,-0.57016003,-12.01703262,-10.27834606,-1.03459871,-12.58533573 &
            ,-9.91770744,-3.60331917,2.90571856,-1.82799375,1.37029648,-0.73886150,5.68148136,-0.20714881,-0.89528203,-1.65603137,-0.04902984,-6.90192795 &
            ,0.79437613,3.62905455,-6.16196918,-5.62923241,-3.30558777,0.07770729,-1.57337379,-0.37467608,-0.24275889,-0.44542655,-2.42649984,1.20868540 &
            ,-1.17078173,-0.31682169,-2.44290996,0.89756161,-2.51918030,8.91158295,-7.45958328,-1.71403599,6.41205263,-3.11346459,-4.61219931,4.35356951 &
            ,-0.35996723,0.32192844,-0.95060897,0.54748684,0.03020389,-0.75941616,-0.43988690,-2.04863787,-0.33498269,1.95144463,0.99378848,3.23606777 &
            ,-0.71429431,-3.69844723,-4.62845325,-2.58186531,-3.67850018,0.02840981,0.20103970,0.11966601,0.18798679,0.11389494,0.27434021,0.38029629 &
            ,2.10867190,1.76402533,2.74472284,-0.32751691,1.53851128,2.14760280,1.99019992,0.86179346,1.61861897,0.42323840,-6.96763897,-6.71112919 &
            ,-7.19536018,-6.24927330,-7.73433590,-3.99769092,-5.60157681,-3.37437963,-9.92302799,-4.70651484,-5.22129345,-1.63401866,-4.95865202,-3.78094840 &
            ,-5.74146461,-4.53988171,-7.10985279,-1.85324407,0.73590839,1.61073351,0.93366635,-6.99815178,1.12452865,-3.85302091,9.39017963,-2.31554151 &
            ,-7.93516064,3.11953545,5.85542870,-3.80574799,-1.83883762,0.76163924,-6.23445940,5.08252668,2.02899694,2.10271811,3.64022613,4.15606403 &
            ,1.98489046,-0.22991872,-1.79602897,-1.77791834,6.04385853,3.35186887,4.29824018,-2.01745939,-1.79930925,-1.64707446,0.58072335,0.90829414 &
            ,-4.04175568,-2.29015923,0.78390223,1.72224295,3.68118143,9.21566772,2.92942905,2.83821201,-2.87441206,0.79813796,5.70863724,5.20058250 &
            ,-6.47943687,-12.26072311,5.74755144,-1.23690438,6.78601646,-7.83034658,-7.21358681,1.99166584,-0.75350225,-2.85969281,2.21939611,-0.86698365 &
            ,-1.59773886,-13.53116989,7.94793415,-12.74881744,1.28042471,7.03222561,-1.95857811,3.70666051,-2.13538909,-3.95967340,8.73187256,-0.19745547 &
            ,0.98733395,0.05790181,2.51404023,1.43157578,0.73324656,0.88881737,4.35168791,5.94759226,-0.73070663,-4.22012377,-0.92918593,-5.01301289 &
            ,-6.55218029,-6.53057909,-3.62168598,-7.54675198,-0.09790902,0.13217846,0.26483980,0.36518344,0.31895167,0.34169221,0.42679536,3.33981752 &
            ,3.84397292,-2.67159271,2.85513091,3.80504751,3.00464821,-0.16379924,-1.63568521,3.39016128,3.39322233,1.97996736,-4.33666801,0.30284148 &
            ,1.60806608,0.70916969,0.31199232,-1.24769437,-3.01112509,0.06930408,-4.10616398,-7.46264505,-12.41121006,-8.39530468,-2.58470130,-4.43106270 &
            ,4.16214180,9.72988701,0.57586080,0.14391029,-1.04626477,-2.30949736,-0.60596591,0.99185246,1.48546052,0.71097690,-0.34704638,-0.92979366 &
            ,0.48549521,-2.57053733,0.97953695,-0.00950646,0.55393624,-0.89420128,0.50233507,3.16359711,5.56993961,2.24331975,-0.88114536,-1.10209894 &
            ,-3.65852880,-4.20702267,-3.82087445,-9.36374664,-1.50440657,3.84138250,4.93546247,3.51491666,5.79686069,3.42403746,1.03561270,-2.52808595 &
            ,0.98456621,0.49968737,0.15505312,1.16577315,-1.61361277,2.74959230,-3.83179641,5.68250227,-6.28411865,-1.76865530,-3.96752453,-9.48724556 &
            ,-9.24403191,-0.16135693,-4.31467915,-4.29688740,4.08732033,1.11265790,0.50759435,0.43538129,-0.81909162,1.36364818,-0.49473494,-0.44394436 &
            ,-1.80794251,-1.53411365,-3.58711624,8.05080605,-10.09714317,8.81187820,-0.27118084,-0.55745679,3.73408699,-2.70545530,0.60365450,1.04025710 &
            ,-0.44319373,0.62652427,0.05124189,1.10654700,0.67798209,2.67764235,4.59707546,1.43963218,1.63263047,1.71055400,-1.04028559,-2.80814266 &
            ,-2.49411392,-1.77408874,-2.88861513,-0.25530866,-0.02183507,0.08060549,0.13776964,0.26199353,0.25997338,0.46938661,0.63035202,-0.44776186 &
            ,-0.49666083,0.36271319,1.23591268,-0.60113907,0.34277904,-0.68965465,1.00528395,10.21101379,7.13979864,0.55671775,4.26659632,3.59938931 &
            ,0.47711971,-2.45584536,-7.12782288,4.45489597,-4.44947529,-21.08076859,-18.79756927,-14.11458683,-22.87327003,-8.59540081,5.39298725,-9.08978081 &
            ,-14.50158119,-0.31559634,-1.26731992,-0.12225012,0.11041318,-1.34025502,0.71444011,-1.37013054,4.31063843,-3.29560161,1.01405954,3.94719982 &
            ,-0.66894990,0.93763530,2.07921696,-2.59550381,-4.24521065,4.55374622,-11.11560345,-9.68781757,-8.50530624,-2.01468253,1.40202034,-3.67594147 &
            ,0.81214201,0.74336964,-5.96771765,9.04027367,-6.49670362,3.88933778,-5.36335468,-11.47798252,-4.35367584,-5.40870619,-8.14149952,1.72722614 &
            ,-2.43563032,1.20069611,0.85290653,3.62189150,0.65600324,-1.33776248,-3.25929570,0.36488152,-6.07081509,1.12953615,-0.22853939,-2.58491945 &
            ,-4.73671007,-1.99148321,-1.99161243,0.16722539,-0.80900133,-0.75633562,-0.09794225,-1.67262626,0.99301195,-0.82925677,-0.34796989,-1.10525501 &
            ,0.38915116,-1.28182101,10.57578468,-8.65317535,-0.64208496,3.94246721,-3.58744216,-2.26657414,2.82913709,-0.58584040,0.32087746,-1.21368289 &
            ,0.29305786,-0.06053551,-1.46875048,-0.58907318,-2.54582167,-0.30838543,3.78571939,2.43454647,3.92684317,-0.58063620,-3.92119575,-5.17721748 &
            ,-3.45232153,-3.81876421,0.10645084,0.30162355,0.16138454,0.14004929,0.03236388,0.33299342,0.43858367,2.60554314,3.18715119,3.51703596 &
            ,-0.42144209,1.56049633,1.40380037,1.78282666,1.50392520,1.68632352,-0.02438441,-8.42320442,-1.85968924,-2.93902421,-5.67808723,-12.05179691 &
            ,-5.00260544,6.00856209,-3.80136442,2.97279358,10.17834377,9.70564842,-2.02340984,-11.59367085,-3.09384251,9.60796738,0.51551682,-0.42241666 &
            ,-0.75122899,2.23053575,0.15942809,-0.62933391,-0.28429630,-0.47375616,2.25027752,-0.40700027,2.29589748,0.66681540,-0.51762688,-6.05904198 &
            ,-0.11571667,2.87551069,-0.53298002,-3.23900461,4.57098866,1.83245599,-0.33752936,0.86849374,2.10144067,1.87664127,1.69279265,2.40452409 &
            ,0.64616692,-2.62716675,-3.73220205,-0.30654192,-4.39305782,-12.20949745,-0.44728473,-1.52112889,-0.99114037,-1.22456825,1.74980056,2.10357547 &
            ,2.37253714,2.79947090,4.62063217,4.67234421,0.02653433,1.35465157,3.95333004,-16.08469772,8.23838997,2.76178670,-12.31441212,0.52210218 &
            ,0.37701005,0.36589587,12.63570595,2.83528018,-3.01230645,0.15726912,-2.46236610,-1.76797938,-1.25929379,0.57667583,12.10220432,-10.02549076 &
            ,5.74954653,-4.67204571,6.23806620,-2.85316372,1.43687499,3.86995459,-1.34954453,0.23422228,1.45822120,0.47776639,1.19452119,-1.07405710 &
            ,-0.51746470,1.93191719,-3.40986419,-1.60455680,1.03311825,-1.07032108,-4.00234413,-5.36617470,-0.61265874,-0.97894526,1.52662277,1.11023796 &
            ,0.62279761,0.09677844,-0.16026767,0.05171299,0.38158894,-0.33130187,0.51453841,1.17909718,2.06582022,1.15385652,0.21327578,-1.56914520 &
            ,0.08972725,0.71842265,-0.67097390,0.43534866,0.54352117,-2.15522575,1.81946361,2.70909452,2.64346719,2.97642922,3.65816903,2.89002800 &
            ,1.71697700,14.70379543,5.04662132,1.04184961,1.45498025,-1.17943752,-0.67961359,-0.27892178,0.14380573,0.30838984,-0.38878474,-0.03762855 &
            ,0.02346689,-0.09288380,-0.29245299,-0.21494572,-0.03075404,-0.00460185,-1.00370622,-0.17678009,-0.01537607,0.00254849,-0.30400637,0.09598108 &
            ,0.06109090,0.01075036,-0.10256361,0.28339565,-0.66121203,-0.84960246,0.36560315,0.43498546,1.62130594,-0.22545977,0.62589818,5.64353991 &
            ,2.16421795,1.05094469,-0.29221264,-0.13444805,-0.92425120,0.75312167,-1.21680713,0.68304801,0.26749790,0.08350423,-0.10748030,-0.28674904 &
            ,0.04339939,-0.02760041,0.25534272,-0.11917330,-0.53675473,-0.08560142,-0.66121364,0.28141743,0.17291319,-0.89965558,0.10764483,0.14572382 &
            ,0.05155224,0.26039881,0.22373517,-0.22804928,-0.01487440,-0.12335880,-0.20917460,-0.16047001,0.04751754,0.62618339,-0.13101691,0.01988424 &
            ,-0.32358956,0.65313375,-0.51601994,0.37640437,0.15802316,-0.16154559,0.15317415,0.10514550,-0.05057791,-0.05843502,-0.12142469,0.00930199 &
            ,0.28246942,-0.08770743,0.06078374,0.36784190,-0.29390270,-0.22536683,-0.61197162,-0.06321235,-0.17628217,0.31603056,0.31027818,0.33397332 &
            ,-0.04973078,-0.03688368,0.00158906,0.04471173,0.05262738,0.03485478,0.07091743,0.20427452,0.16329718,0.07009768,-0.06512830,0.01646278 &
            ,-0.06530416,0.03184691,-0.05562402,0.08588884,0.10572134,-1.45183325,-1.22979677,-2.45889783,4.61173534,1.23980451,0.10310449,4.71970272 &
            ,-6.08631611,-10.58487320,-15.16231728,-4.69157839,-7.34990120,0.08409724,-1.72523558,-1.49675763,-0.81784439,0.02379611,0.18202564,-0.00208957 &
            ,-0.03623497,-0.56088525,0.02431285,-0.07847891,0.08353256,-0.30624753,0.79938126,0.66962421,0.31694245,0.65492189,0.34778321,-0.34408113 &
            ,0.03500685,0.48871163,-0.21308327,0.26508817,-0.63658881,-1.22359610,-1.53627706,-0.78266764,-2.34169888,1.18065429,5.91574001,2.09589005 &
            ,0.03412598,-4.11368799,-5.83301497,-2.13922668,3.97442627,-5.22353268,3.15659976,0.33333474,-0.02315570,-0.11818099,-1.05458200,-0.93009514 &
            ,-0.40384501,-0.21130094,0.32174176,0.25149482,0.04329769,1.31626701,-0.20653367,1.18433177,-0.77669531,0.73112142,0.05159926,0.70489508 &
            ,-0.80697989,0.29334623,-0.13999820,-0.32210636,0.11819530,-0.22486442,-0.29355067,0.09189522,0.19813216,1.14413023,-0.76070887,-1.08658814 &
            ,1.03677440,-1.29796517,1.13073158,0.24500346,-0.53566194,0.46316853,0.35331219,-0.20143089,-0.29462174,-0.16503954,0.16630846,0.56495833 &
            ,0.02163770,0.50211251,-0.59733510,-0.26826960,-0.12494313,-0.14323205,-0.06928927,0.90940708,0.15735300,0.39849621,0.56460243,-0.07123414 &
            ,-0.00208216,0.02568075,0.18644622,0.26199365,0.00152209,0.00252181,0.04900217,0.21453428,0.31884611,-0.01026600,-0.19271199,-0.14969538 &
            ,0.09652112,-0.42929012,-0.00165612,0.44246882/),(/8,119/))
real, dimension(2,8) :: hidden1 = &
  Reshape((/-6.74145460,-20.13047791,10.32099342,15.80145836,12.03629398,1.07430494,-10.65626144,24.41726875,-2.01975012,-0.49655500,0.32860032,-0.06671546 &
            ,-2.29340649,2.63832974,-5.71988344,-1.78080642/),(/2,8/))
real, dimension(1,2) :: hidden2 = &
  Reshape((/0.96779275,-2.01705217/),(/1,2/))
real, dimension(8) :: bias1 = &
  (/24.48849678,19.41885376,-3.46805763,5.36139107,20.79779816,-12.89077473,-4.10160255,0.42258677/)
real, dimension(2) :: bias2 = &
  (/10.22404861,-1.38463736/)
real, dimension(1) :: bias3 = &
  (/0.10225958/)
contains
subroutine fnet_EMM_initall()
end subroutine fnet_EMM_initall
subroutine fnet_EMM_engine(inarray, outarray, init)
  intrinsic MatMul, Size
  real, dimension(:), intent(in) :: inarray
  real, dimension(:), intent(inout) :: outarray
  real, dimension(119) :: inarray2
  real (kind=8), dimension(8) :: layer1
  real (kind=8), dimension(2) :: layer2
  real (kind=8), dimension(1) :: layer3
  integer , intent(inout) :: init
  integer :: i, j
  do i = 1, 119
    inarray2(i) = inarray(120-i)
  end do
  layer1 = MatMul(input,inarray2)
  layer1 = layer1 + bias1
  do i = 1, Size(layer1,1)
    layer1(i) = 1.0 / (1.0 + DEXP(-1.0 * layer1(i)))
  end do
  layer2 = MatMul(hidden1,layer1)
  layer2 = layer2 + bias2
  do i = 1, Size(layer2,1)
    layer2(i) = 1.0 / (1.0 + DEXP(-1.0 * layer2(i)))
  end do
  layer3 = MatMul(hidden2,layer2)
  layer3 = layer3 + bias3
  outarray(1) = layer3(1)
end subroutine fnet_EMM_engine
end module fnet_EMM
