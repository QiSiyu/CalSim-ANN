module fnet_EMM

! a = 0.00014358
! b = 0.075993


intrinsic Reshape
real, dimension(8,119) :: input = &
  Reshape((/0.105869007967,-0.032132087176,0.135266358749,-0.269309386986,0.598858122206,-0.011966681268,-0.325864308716,-0.273404033393,0.286742524735,-0.030405345947,0.148396049359,-0.298455539718 &
            ,0.567021648816,-0.134733783174,-0.392550790814,-0.238637250949,0.398661005033,-0.025152484809,0.070564295346,-0.240250099448,0.320471578796,-0.184443167708,-0.201205079945,-0.245710154031 &
            ,0.198423097426,-0.024187013268,0.115344051269,-0.273558340569,0.276777637159,-0.230410079064,-0.330791389678,0.068892832794,0.411259123120,-0.018286874678,0.053309798296,-0.231399197338 &
            ,0.100613226034,-0.047140807859,-0.239932595339,0.019090774571,0.334347809093,-0.010697453150,0.051018914486,-0.209750369214,-0.023067550810,0.031352091214,-0.039616894258,-0.174017459592 &
            ,-0.007732792537,-0.012752750389,0.056388021708,-0.311993002463,0.095703334148,-0.073226186504,-0.261924775259,0.006109204505,1.348016598629,0.009332593544,-0.047631506265,-0.251802231837 &
            ,-0.065878073866,0.495795003340,0.095941527436,-0.247319625418,0.698062042991,0.061227927964,-0.021517833894,-0.087159473457,-0.116090468182,0.230993298757,0.160014395146,-0.169257867768 &
            ,0.319638380427,0.080819657309,-0.065356263081,0.072954395621,-0.122047141482,0.294718084801,0.176130399607,-0.125014233193,0.206527226076,0.112847057480,-0.040419833987,0.368167754623 &
            ,-0.213454701458,0.354246109679,0.487974594424,-0.493969156157,0.009211359121,0.130511750218,0.007068323663,0.635353644627,-0.141112615253,0.231328758058,0.783940856874,-0.652274730155 &
            ,0.042644613354,0.113628426175,-0.078125568954,0.399603099191,-0.046415573489,0.044102920390,0.395854965053,-0.429284317254,0.044682336276,0.111548170588,-0.084064227806,0.225022316445 &
            ,0.155781342819,0.040044178405,-0.141940171272,0.066352501574,0.033455878233,0.046050310971,-0.136082633957,0.022226312264,-0.129184931698,-0.032002947296,0.089418903079,0.061716370011 &
            ,0.073406956534,0.076632967308,-0.025435928795,0.140814405823,-0.163835851965,-0.008889358802,0.052555603956,0.028399581390,0.092177669938,0.061862214996,0.150872206013,-0.003057972531 &
            ,0.018588083995,-0.137677527000,-0.100077298420,0.081087738907,-0.033014586082,0.052114365883,0.193213211171,-0.137242325513,0.037374011866,0.033171162105,0.079960773517,0.002841452733 &
            ,-0.003519659512,0.053765230535,0.259533647736,-0.128717564740,0.170501594451,-0.076176909561,0.082059028583,-0.035188468626,0.034048534322,0.039494027591,0.153821744845,0.130710106692 &
            ,-0.070891126844,-0.031372549939,0.039281778154,0.130657107012,-0.086952824304,0.047053362222,-0.001714794190,-0.127030690228,-0.044189435938,0.147429172174,0.123253773300,-0.026534423440 &
            ,-0.004659217317,0.070420438668,-0.086423436932,-0.018773624805,0.005406016214,-0.012005383863,-0.079866270141,-0.066184590531,0.009324552127,0.056874649181,-0.039461048855,0.083928076781 &
            ,-0.005960905980,0.034871341929,-0.094400654772,-0.009998989337,-0.048148819001,0.044889165199,-0.126826481955,-0.020928579142,0.144048967000,0.015443871677,-0.078626137921,-0.103183720807 &
            ,-0.036011398248,0.041053420507,0.031724014043,0.065899448394,-0.045042228998,-0.050920082991,0.085599142317,0.201170327926,-0.076927640959,-0.061058497795,0.239007993271,0.096865721810 &
            ,-0.124269681684,0.092843993740,0.084148641665,0.049814390820,-0.152210558476,-0.111915811064,-0.073499042474,-0.084072016685,0.153740540692,0.118871373547,-0.066243596989,-0.291411680133 &
            ,0.111447760327,-0.054128807310,0.084264649573,0.112408834395,-0.175484753259,-0.155654058982,-0.505395421854,-0.247526765621,-0.058467790082,-0.085827137123,0.194610963785,-0.228889722562 &
            ,0.092883825486,0.005326924241,0.572255548131,0.434713740043,-0.040180444649,-0.014710456818,-0.245223213334,0.068948113116,0.307341360190,-0.049951302169,-0.033464367866,-0.134820877983 &
            ,0.096250987601,0.043081691792,-0.140831058630,0.082180054859,-0.093944130725,-0.092655923775,-0.301129868178,-0.064384023295,0.028682303733,-0.050415175776,-0.059314422654,0.248888265069 &
            ,-0.262998279205,0.044095925062,0.129611438568,0.224615231196,0.020781401414,-0.033695999926,-0.165264204920,-0.066700556485,-0.114445471818,-0.021488430143,-0.161911685643,-0.133253989417 &
            ,0.046624138978,0.008431580877,0.950104310147,0.172986595258,0.179375353443,-0.063312920330,-0.252263695150,-0.252748556644,0.137418260314,0.051509688417,0.205724998240,0.050507950991 &
            ,-0.130924424345,0.070654250297,0.218476274762,0.008952630557,0.054391658389,0.043230363084,0.233897016457,0.019243012877,-0.095504279337,0.040985210807,0.122972173273,0.053613354994 &
            ,0.004861797513,0.035897871990,0.226075725613,-0.018625111554,-0.079435207146,0.041136395746,0.062802013569,0.114237998282,0.088291594446,0.035153968077,0.221101899753,0.018113662564 &
            ,-0.096839655530,0.044459127054,0.203683946337,-0.024605901447,0.052955868260,0.032796265094,0.209159665963,0.014418933040,-0.121420121988,0.003351152153,0.181436037898,-0.019645730033 &
            ,0.066014565689,0.032133862805,0.249845619831,-0.017934176629,-0.113393757321,0.058511059515,0.114963261399,0.094276786702,0.030584513727,0.029309820228,0.258829987935,-0.027263688478 &
            ,-0.088538974418,0.042223104564,0.094704546867,0.102064954156,0.276514339821,0.025683407285,0.254457621605,-0.086494412414,-0.085369947342,0.304193205524,0.014034167189,0.251925073250 &
            ,0.109987908579,0.010650456773,0.263442702899,-0.134635748532,-0.187066438624,0.197483649913,0.219976979340,0.020831681652,-0.069050556326,0.006369242368,0.179611418199,-0.286906634351 &
            ,0.064067215187,0.240535270503,-0.165159213392,0.311635287661,-0.089861043142,0.050794843541,0.179863716974,-0.076516642102,0.366836679990,0.276049095270,-0.217490198250,0.101895268912 &
            ,-0.143158259763,0.061260775630,0.094826844921,0.140118432086,0.466725871638,0.085257554930,-0.104739177762,-0.403509331616,-0.015858073817,0.046921266891,0.103361583736,-0.052942652994 &
            ,0.086156648092,0.131192238476,-0.291988568801,-0.314490240493,-0.103723424740,0.064845704730,0.109387251530,-0.099966444345,0.155614336431,0.100616749752,-0.514710692794,-0.222910970074 &
            ,-0.008619870541,0.062866982530,0.066996578234,-0.001807428861,0.159476572090,0.038990386021,-0.235243476016,-0.404386008622,-0.044144514447,0.056743847303,0.003129863265,0.027132598316 &
            ,0.084142414653,0.053114817698,-0.057868257427,-0.544192501333,-0.101403994193,0.046721982101,0.106030706357,-0.090083265801,0.254013722216,0.064005797573,-0.297099064146,-0.198476407751 &
            ,0.022773931706,0.068432678731,-0.099604047489,-0.022477210272,0.049001555903,-0.077749170475,0.132076604134,0.111986715574,0.017866050295,0.061752302426,-0.150295316359,0.070667603843 &
            ,-0.151912028428,-0.001409482038,0.194130741098,0.049203941694,-0.026265690046,0.056194789300,-0.144156141104,0.111976170023,-0.086182817449,0.103089559976,0.012345366749,0.030699503638 &
            ,-0.015188142631,0.045448609273,-0.201403808720,-0.013106933058,0.010970605546,0.061670265446,-0.178029258293,0.017872367827,0.010509489968,0.045230540022,0.069752699909,0.057358803546 &
            ,0.087360052713,-0.086049611632,0.254568191221,-0.038351322569,0.061068821154,0.039265761568,-0.061658775727,0.085256263366,0.263889391733,-0.140651385399,-0.066057699930,0.256900002484 &
            ,0.081751795710,0.043133224963,0.175414764167,0.159352362731,-0.016239928272,-0.156970014674,0.184259113877,0.169451538573,-0.055255084913,0.043587027643,0.323102393413,-0.272062171784 &
            ,0.039976534725,-0.040325112896,0.259166044105,0.059377246566,-0.140457554941,0.024033919967,0.260165162121,-0.146049872867,0.073096718296,0.114006725428,0.022961550208,0.177575861033 &
            ,-0.049379279570,0.057442706133,0.182019761867,0.368006308496,0.041790392175,0.211615710927,-0.185400952080,0.100633972005,0.083265498275,0.017169674101,-0.066415460783,-0.029824279753 &
            ,0.365105483672,-0.314245130627,-0.056350213155,-0.375231945876,0.031311601544,-0.020500231236,-0.145676883010,-0.240609948464,0.114625027763,-0.193519766665,0.168110110328,0.048471735665 &
            ,-0.012299838874,0.012824999277,-0.113155161053,0.244012635600,-0.120756702601,0.112536187309,-0.049444067065,-0.135369825929,-0.048721622259,0.020414431015,-0.125932085526,0.126781138258 &
            ,0.177609080609,0.078254983950,-0.474587764597,-0.650378589085,-0.059638498151,0.000154319034,-0.042086389642,0.033047217186,-0.305229886292,0.243626389707,-0.464438564612,-0.262111685341 &
            ,0.204914696082,0.007644487447,0.219535587257,0.484130793967,-0.302437766555,-0.212579085858,-0.166545779602,-0.069749331807,0.100875320763,-0.055689733893,0.039595805908,0.010311459571 &
            ,0.181632147907,-0.301139034047,-0.003632329806,0.107865886704,0.004890393090,-0.026976679083,0.109246995617,0.063703848059,-0.048898389647,0.069289302872,0.181028841388,0.221378161153 &
            ,-0.069422237607,-0.031725925295,0.081244261626,-0.044779325492,0.077902145401,0.060786155319,0.059305397233,-0.068786552091,0.002475473146,-0.034492067800,0.097711865455,-0.031635850845 &
            ,-0.000384694748,-0.015765821148,-0.073468130509,-0.054179771345,0.016949735654,-0.029069412975,0.073326663767,-0.094356664950,0.086632746645,-0.068092030784,-0.232236572847,-0.344910589737 &
            ,-0.028579287957,-0.025642182218,0.256063597181,-0.084924653570,-0.042830664085,0.012619990409,-0.054817707411,-0.247231400345,-0.016625957595,-0.027859650653,0.128035630037,-0.108493657370 &
            ,-0.115419356009,0.057690795309,-0.108283533443,-0.144780381705,-0.032592106368,-0.044000675502,0.125164192142,-0.084885173828,-0.148863370500,0.048700111500,0.112214147207,0.011256072474 &
            ,0.091775263075,-0.018165125057,0.415473136227,-0.132657567816,0.086259277590,-0.269195458912,-0.023874778437,-0.177124187082,0.104005456284,0.033796705670,-0.000539563253,0.275526854777 &
            ,0.187427499133,-0.170714494400,-0.189291485679,-0.001311612229,0.086487083355,0.006678186658,0.288641831815,0.010759154521,-0.193487926744,-0.069751877784,-0.096231604153,-0.031879396703 &
            ,-0.027526125162,-0.023737981319,0.134910719374,0.300647527021,0.017490891919,0.136231533420,0.175926117711,0.594312320701,-0.083394078375,-0.013233046263,0.116009316711,-0.233968221534 &
            ,0.047899470407,0.061686155358,0.155170753425,-0.267568985379,0.159892695014,0.076913289794,-0.373427609050,0.214831735298,0.110986211035,-0.213234186876,-0.268883870338,0.353884202146 &
            ,-0.071052802818,0.052815775303,0.122147432252,-0.100611675106,0.033443563949,0.083287097995,0.079063500056,-0.035571902215,0.050293641299,0.012343365550,-0.033587422383,0.023217765836 &
            ,-0.164781057644,-0.052837041792,0.164729530497,0.147069451129,-0.102594386298,-0.097769223543,0.518039411274,-0.022842028047,0.062652438077,0.172333775300,0.145688087712,0.129074543755 &
            ,-0.193907104269,-0.135517480871,0.332152132489,-0.000436048940,-0.283989309018,0.391658519066,-0.247318401185,-0.521806352322,0.009035055122,0.005483454055,-0.221933039827,-0.032702073269 &
            ,0.013643408609,-0.031115492402,0.098123227504,0.216507122449,-0.059646610137,-0.005334946985,-0.161354889123,0.025191911794,-0.056455990874,0.126815263424,0.002981661226,-0.090584268018 &
            ,-0.020696243246,-0.009752048185,-0.051416750713,-0.020052926347,-0.111178618668,0.057082817493,-0.056240416870,-0.115264088220,-0.045954029949,0.005244937812,0.083612085721,-0.075944307911 &
            ,-0.137042719692,0.141589502293,-0.000840427697,0.007985257234,0.000056921175,0.014379161208,-0.190754687319,-0.141646860099,-0.027813152631,-0.002188053477,0.108584531860,0.078350533848 &
            ,-0.017310277361,0.026970771721,-0.162781715450,-0.120052512170,-0.147120166370,0.073255696480,-0.084447333756,-0.079030145620,-0.048794270437,0.002888972479,-0.056008269345,-0.016992817768 &
            ,0.095617944624,0.079497208031,0.060499761168,-0.006023973970,-0.018003098008,0.013691916973,-0.211576876259,-0.175354606102,-0.601049639229,0.268607673516,-0.450484699401,-0.365205639123 &
            ,-0.289313851155,-0.049234788605,-0.570082615548,-0.492985702301,-0.146541027193,0.616378716302,0.300417647343,0.013195826862,0.065286124845,-0.022212875728,-0.233895716854,0.271915334733 &
            ,0.033259051120,-0.116924786906,0.060835623659,0.404836990737,-0.108529849797,0.041371879257,0.086140399680,0.117077122301,0.144598921976,0.174798023612,-0.013971752353,-0.028161374882 &
            ,0.089085303525,0.096028899257,-0.018618930452,0.283667458999,-0.029973256470,-0.139419561504,0.124592773850,0.434858043137,-0.112880625062,0.066532917564,-0.115403112502,-0.071470981404 &
            ,0.103749247118,0.174725506494,0.160478776616,0.051732588823,0.044333388506,0.046188610853,0.251124368181,0.121430692754,-0.237196331287,-0.020749913287,-0.430247672405,-0.365671535199 &
            ,-0.263524831963,-0.046593686553,0.070437240734,-0.311044107309,-0.119164262286,0.518274016724,-0.050553610803,-0.500148691921,-0.080469513883,0.056436295333,-0.420856602575,-0.215946415709 &
            ,-0.045907151133,0.205197848033,0.100946601991,0.021461790028,-0.100366968791,0.038291003464,0.053234845248,-0.078801043002,-0.055714122057,0.254183334108,-0.417941313837,-0.562871098745 &
            ,0.028796196861,0.015828488121,0.043470775512,0.069024122422,-0.054053677705,-0.016046971461,-0.068136040376,0.009932247594,0.016416853824,0.015940131092,0.085518532486,-0.008270625861 &
            ,-0.044531080006,-0.027914122448,0.097446348872,0.108556665649,-0.031266425757,0.028480220765,-0.266253482632,-0.083334518125,0.016396724020,0.040185203202,0.007427133627,-0.008178651772 &
            ,0.006214642553,0.018883806406,0.017250835648,0.082998695035,0.071016103976,0.002050806059,-0.043010275003,0.029744399299,-0.011646694493,-0.024494774831,-0.059361180823,-0.033133496487 &
            ,-0.039359656459,0.018814264701,0.126327982034,0.109966323193,-0.036601724913,-0.025640153883,-0.052631228716,-0.088852478276,0.079966955703,0.015597931734,0.197660473126,0.135973348125 &
            ,0.004001090834,0.004950613820,-0.004726544184,0.058349092106,-0.002478580083,0.007934317240,-0.151370943147,-0.118238773130,0.011613525729,0.091404250048,-0.243743361661,0.007823522136 &
            ,-0.001283434428,0.027196934729,0.356621439954,0.493463405505,0.018074921476,0.011177370217,-0.019494356542,0.274288250476,0.058456181802,0.049800416481,0.019370293117,0.214132835542 &
            ,-0.022409983736,-0.147815945323,0.255015507257,-0.013605898850,-0.027974693678,-0.008804178117,0.181423139255,0.058172349318,-0.015566614687,-0.129133755497,0.209423522326,0.000232886425 &
            ,-0.093499365548,0.022565466458,-0.067726914119,-0.141315180486,-0.084341161551,-0.124533653228,0.052282942982,0.088485876001,-0.009324907998,0.151226214973,-0.109007917903,-0.171790321797 &
            ,-0.040906589737,0.001827129235,-0.154755118872,0.082313115608,0.025158319583,0.078553235378,-0.220809481126,-0.236690898662,-0.012384480562,0.004293180242,0.132811226778,0.108864251741 &
            ,0.055648142300,0.035099223096,-0.242086286330,-0.232090576488,0.036924584067,-0.044366054641,0.459085201454,0.328236674798,0.105313969992,-0.081917266637,-0.236116496235,-0.272385417836 &
            ,0.066903164812,-0.088854496869,0.287577547834,0.316835254976,-0.059876419841,-0.105534864282,-0.160480727285,-0.166576082876,0.081369507547,-0.006613788863,0.143548274072,0.138816888076 &
            ,-0.164184443777,-0.092370410213,-0.262835650699,-0.217626862222/),(/8,119/))
real, dimension(2,8) :: hidden1 = &
  Reshape((/-0.42431,-5.0093 &
            ,-0.16962,1.2575,-0.13388,1.4279 &
            ,0.12897,0.84703 &
            ,-0.1261,-1.0157 &
            ,-0.13425,-2.4901 &
            ,0.081346,-1.523 &
            ,-0.042327,1.6413 &
            /),(/2,8/))
real, dimension(1,2) :: hidden2 = &
  Reshape((/0.013387,1.9848/),(/1,2/))
real, dimension(8) :: bias1 = &
  (/4.2728,-0.12515,-0.20508,-0.26474,0.58259,2.7021,1.2554,-1.6968/)
real, dimension(2) :: bias2 = &
  (/0.042693,-1.1855/)
real, dimension(1) :: bias3 = &
  (/0.99372/)
contains
subroutine fnet_EMM_initall()
end subroutine fnet_EMM_initall
subroutine fnet_EMM_engine(inarray, outarray, init)
  intrinsic MatMul, Size
  real, dimension(:), intent(in) :: inarray
  real, dimension(:), intent(inout) :: outarray
  real, dimension(119) :: inarray2
  real (kind=8), dimension(8) :: layer1
  real (kind=8), dimension(2) :: layer2
  real (kind=8), dimension(1) :: layer3
  integer , intent(inout) :: init
  integer :: i, j
  do i = 1, 119
    inarray2(i) = inarray(120-i)
  end do
  layer1 = MatMul(input,inarray2)
  layer1 = layer1 + bias1
  do i = 1, Size(layer1,1)
    layer1(i) = 1.0 / (1.0 + DEXP(-1.0 * layer1(i)))
  end do
  layer2 = MatMul(hidden1,layer1)
  layer2 = layer2 + bias2
  do i = 1, Size(layer2,1)
    layer2(i) = 1.0 / (1.0 + DEXP(-1.0 * layer2(i)))
  end do
  layer3 = MatMul(hidden2,layer2)
  layer3 = layer3 + bias3
  outarray(1) = layer3(1)
end subroutine fnet_EMM_engine
end module fnet_EMM
